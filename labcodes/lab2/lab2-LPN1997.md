# Lab2 report

##[练习1] 实现first fit物理内存分配算法
###我的实现分别修改了default_init_memmap, defaulte_alloc_pages, default_free_pages三个函数
* default_init_memmap函数：
    *  初始化部分与参考实现一致
    *  最后在链表中加入一个大小为n的块
    *  修改空闲页数为n
* default_alloc_pages函数：
    *  首先从头开始遍历链表，找到第一个property >= n的块，设块为base
    *  对页非空且块内页数大于n的情况做如下处理：
        *  修改base+n的页标志位，使之和往后的页成为一个新的空闲块，并加入到base块之后
    *  删除base块，修改base块内页标志位，减少总空闲页数
    *  返回base对应page 
* default_free_pages函数：
    *  修改释放页的标志位
    *  从前往后遍历链表，找到要释放的页所对应的位置
    *  检查能否与相邻低地址的空闲块合并，若可以合并则修改该块的首页property+n并将base重设为该页，否则建立新的空闲块并插入链表对应位置
    *  检查能否与相邻高地址的空闲块合并，若可以合并则修改base的property并删除高地址空闲块，否则不做处理
    *  修改总空闲页数
    
###与标准答案的比较
* 标准答案与我做法的一个很大不同在于链表的元素，我的做法是连续的空闲页作为一个元素，而标准答案则是一页一个元素
* 这就导致了在free的合并时，我的做法可以不用遍历就直接得到可合并块的首页

###改进空间
* 感觉只有在特殊的alloc和free请求下可以优化
    
##[练习2] 寻找虚拟地址对应的页表项
###简要设计
* 先从页目录表中找到对应页表
* 若页表不存在且要求创建则alloc一页并设置引用清空填写页目录表项
* 返回页表中对应的项

###请描述页目录项(PageDirectorEntry)和页表(PageTableEntry)中每个组成部分的含义和以及对ucore而言的潜在用处。
* 高20位是对应的页表/页的物理基址，低12位是标志位
* emmmm。。。潜在作用？标志位可以起到保护，加速等作用

###如果ucore执行过程中访问内存,出现了页访问异常,请问硬件要做哪些事情?
* pc跳转至异常处理程序入口地址，并保存一部分现场

###与标准答案比较
说实话没什么区别

##[练习3] 释放某虚地址所在的页并取消二级页表项的映射
###简要设计
* 若该页存在则
    * 减少页引用次数，若已无引用则释放页面
    * 二级页表项清空
    * tlb无效化
    
###数据结构Page的全局变量（其实是一个数组）的每一项与页表中的页目录项和页表项有无对应关系？如果有，其对应关系是啥？
有，从函数pa2page可以看出物理地址pa所对应的页就是pages[pa >> 12], 而物理地址就可以从页目录表项和页表项里得到。

###如果希望虚拟地址与物理地址相等，则需要如何修改lab2，完成此事？ 鼓励通过编程来具体完成这个问题
需要将kernbase下调至0,
###与标准答案比较
没什么区别
##重要知识点
* first fit算法
* 地址页表映射关系
* 多级页表组织结构
